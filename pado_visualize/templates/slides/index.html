{% extends "layout.html" %}

{# the creates one slide card #}
{% macro slide_card(image_id, image) %}
  <a href="{{ url_for('slides.viewer_openseadragon', image_id=image_id) }}">
  <div class="card slide-card">
    <div class="thumbnail">
      <img src="{{ url_for('slides.thumbnail', image_id=image_id, size=200) }}" alt="{{ image_id }}">
    </div>
    <div class="title">{{ image_id.last }}</div>
    <div class="indicators">
    </div>
  </div>
  </a>
{% endmacro %}


{% block styles %}
  {{ super() }}
  <link rel="stylesheet" href="{{ url_for_versioned('static', filename='css/slides.css') }}">
{% endblock styles %}

{% block content %}
  {% block filter_bar %}
    <div>
      <fieldset>
        <legend>Filter by:</legend>
        <form action="" method="get">
          <li>
            <label for="filename_filter_checkbox"></label>
            <input 
              id = "filename_filter_checkbox" 
              type="checkbox" 
              onclick="EnableFilter(this)"
            >
            <span>
              Filename:
              <input 
                type="text" 
                id="filename_filter_widget" 
                name="filename" 
                disabled="disabled" 
              />
            </span>
          </li>
          <li>
            <label for="metadata_filter_checkbox"></label>
            <input 
              id = "metadata_filter_checkbox" 
              type="checkbox" 
              onclick="EnableFilter(this)"
            >
            <span>
              Metadata:
            </span>
            <select 
              id="metadata_filter_widget" 
              name="metadata_key" 
              disabled="disabled" 
              onclick="EnableMetadataOptions(this)"
            >
              {% for attribute in metadata_attributes.keys() %}
                <option value="{{ attribute }}">{{ attribute }}</option>
              {% endfor %}
            </select>
            <select 
              id="metadata_filter_widget_options" 
              name="metadata_values" 
              disabled="disabled"
            >
              {% for option in selected_metadata_attribute_options %}
                <option value="{{ option }}">{{ option }}</option>
              {% endfor %}
            </select>
          </li>
          <p><input type="submit" value="Filter"></p>
        </form>
      </fieldset>
    </div>
  {% endblock filter_bar %}

  {% block thumbnails %}
    {% include "./slides/thumbnails.html" %}
  {% endblock thumbnails %}

{% endblock content %}

{% block page_scripts %}
  <script type="text/javascript" src="{{ url_for_versioned('static', filename='js/slides_deckgl.js') }}"></script>
  <script>
    function EnableFilter(checkbox) {
      filter_widget_id = checkbox.id.replace('checkbox', 'widget');
      var filter_widget = document.getElementById(filter_widget_id);
      filter_widget.disabled = checkbox.checked ? false : true;
      if (!filter_widget.disabled) {
        filter_widget.focus();
      }
    }
    function EnableMetadataOptions(metadata_selection) {
      // TODO: try find a smarter way of implementing a dependent dropdown list
      const metadata_attributes = {{ metadata_attributes | tojson }};

      const secondselect = document.getElementById('metadata_filter_widget_options');
      secondselect.innerHTML = null;
      secondselect.disabled = false;
      
      for (const value of metadata_attributes[metadata_selection.value]) {
        const option = document.createElement('option');
        option.value = value;
        option.innerHTML = value;
        secondselect.appendChild(option);
      }
    }
  </script>
{% endblock page_scripts %}

